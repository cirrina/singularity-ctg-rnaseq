Bootstrap:docker
From:nfcore/base


%environment
    export PATH=$PATH:/opt/software/conda/bin/
    source /opt/software/conda/bin/activate /opt/software/uroscan_env


%files
    # qualimap_v2.2.1 /opt/software/
    # picard.jar /opt/software/
    # bladderreport /opt/software/
    # salmon /opt/software/

%post
    # apt -y install epel-release wget which nano curl zlib-devel
    # apt -y groupinstall "Development Tools"

    rm -rf /var/lib/apt/lists/*
    apt -y clean
    apt -y update

    apt -y install curl libz-dev build-essential gettext cmake libxml2-dev make libcurl4-openssl-dev libssl-dev libbz2-dev libboost-dev sudo tree 


    mkdir -p /opt/software

    cd /opt/software
    curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    sh ./Miniconda3-latest-Linux-x86_64.sh -p /opt/software/conda -b

    /opt/software/conda/bin/conda config --add channels defaults
    /opt/software/conda/bin/conda config --add channels conda-forge
    /opt/software/conda/bin/conda config --add channels bioconda
    /opt/software/conda/bin/conda config --add channels dranew
    /opt/software/conda/bin/conda install -y -c conda-forge mamba

    /opt/software/conda/bin/mamba create -p /opt/software/uroscan_env -y "python>=3.6" \
      star=2.7.6a \
      bowtie2=2.4.2 \
      bcl2fastq=2.19.0 \
      salmon \
      subread \
      sambamba \
      samtools \
      qualimap \
      rseqc \
      picard \
      fastqc \
      multiqc \
      fastq-screen \
      r-base \
      r-devtools \
      r-dplyr \
      r-knitr \
      r-reshape \
      r-reshape2 \
      r-tidyr \
      r-tidyverse \
      r-kableextra \
      r-jsonlite \
      r-gridExtra \
      r-rmarkdown \
      r-knitr \
      r-ggplot2 \
      r-pheatmap \
      r-cowplot \
      r-plotly \
      r-ranger \
      r-optparse \
      r-rcolorbrewer \
      r-poiclaclu \
      bioconductor-biocparallel \
      bioconductor-tximport \
      bioconductor-biomart \
      bioconductor-deseq2 \
      bioconductor-biobase \
      bioconductor-vsn \
      r-hexbin \
      r-glmpca \
      bioconductor-sva \
      bioconductor-summarizedexperiment \
      bioconductor-dupradar


    source /opt/software/conda/bin/activate /opt/software/uroscan_env
    cd /opt/software

%runscript
    echo "Welcome to the ctg-rnaseq container"
    #exec virsorter "$@"
    exec R --slave -e "sessionInfo()"
    exec R --slave -e "installed.packages()"
    exec STAR --version
    # exec salmon --version
    # exec bowtie2 --version
    exec rsem-calculate-expression --version
    exec geneBody_coverage.py --version
